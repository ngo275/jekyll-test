I"q<p>Grab a coffee ‚òïÔ∏è, sit back and enjoy reading. üòÉ</p>

<p>Wanna know how we improved our app‚Äôs build time performance and developer experience at Grab? Continue reading‚Ä¶</p>

<h2 id="where-it-all-began">Where it all began</h2>

<p>Imagine you are working on an app that grows continuously as more and more features are added to it, it becomes challenging to manage the code at some point. Code conflicts increase due to coupling, development slows down, releases take longer to ship, collaboration becomes difficult, and so on.</p>

<p>Grab superapp is one such app that offers many services like booking taxis, ordering food, payments using an e-wallet, transferring money to friends/families, paying at merchants, and many more, across Southeast Asia.</p>

<p>Grab app followed a monolithic architecture initially where the entire code was held in a single module containing all the UI and business logic for almost all of its features. But as the app grew, new developers were hired, and more features were built, it became difficult to work on the codebase. We had to think of better ways to maintain the codebase, and that‚Äôs when the team decided to modularise the app to solve the issues faced.</p>

<h2 id="what-is-modularisation">What is Modularisation?</h2>

<p>Breaking the monolithic app module into smaller, independent, and interchangeable modules to segregate functionality so that every module is responsible for executing a specific functionality and will contain everything necessary to execute that functionality.</p>

<p>Modularising the Grab app was not an easy task as it brought many challenges along with it because of its complicated structure due to the high amount of code coupling.</p>

<h2 id="approach-and-design">Approach and Design</h2>

<p>We divided the task into the following sub-tasks to ensure that only one out of many functionalities in the app was impacted at a time.</p>

<ul>
  <li>Setting up the infrastructure by creating <strong>Base/Core modules</strong> for Networking, Analytics, Experimentation, Storage, Config, and so on.</li>
  <li>Building <strong>Shared Library modules</strong> for Styling, Common-UI, Utils, etc.</li>
  <li>Incrementally building <strong>Feature modules</strong> for user-facing features like Payments Home, Wallet Top Up, Peer-to-Merchant (P2M) Payments, GrabCard and many others.</li>
  <li>Creating <strong>Kit modules</strong> to enable inter-module communication. This step helped us in building the feature modules in parallel.</li>
  <li>Finally, the <strong>App module</strong> was used as a hub to connect all the other modules together using dependency injection (Dagger).</li>
</ul>

<div class="post-image-section"><figure>
  <img src="/img/app-modularisation-at-scale/image1.png" alt="Modularised app structure" style="width:90%" /> <figcaption align="middle"><i>Modularised app structure</i></figcaption>
  </figure></div>

<p>In the above diagram, <em>payments-home</em>, <em>wallet top-up</em>, and <em>grabcard</em> are different features provided by the Grab app. <em>top-up-kit</em> and <em>grabcard-kit</em> are bridges that expose functionalities from <em>topup</em> and <em>grabcard</em> modules to the payments-home module, respectively.</p>

<p>In the process of modularising the Grab app, we ensured that a feature module did not directly depend on other feature modules so that they could be built in parallel using the available CPU cores of the machine, hence reducing the overall build time of the app.</p>

<p>With the <em>Kit</em> module approach, we separated our code into independent layers by depending only on abstractions instead of concrete implementation.</p>

<h2 id="modularisation-benefits">Modularisation Benefits</h2>

<ul>
  <li><strong>Faster build times and hence faster CI</strong>: Gradle build system compiles only the changed modules and uses the binaries of all the non-affected modules from its cache. So the compilation becomes faster as independent modules are run in parallel on different threads.</li>
  <li><strong>Fine dependency graph</strong>: Dependencies of a module are well defined.</li>
  <li><strong>Reusability across other apps</strong>: Modules can be used across different apps by converting them into an AAR/SDK.</li>
  <li><strong>Scale and maintainability</strong>: Teams can work independently on the modules owned by them without blocking each other.</li>
  <li><strong>Well-defined code ownership</strong>: Easier to define ownership per module in the codebase.</li>
</ul>

<h2 id="limitations">Limitations</h2>

<ul>
  <li>Requires more effort and time to modularise an app.</li>
  <li>Separate configuration files to be maintained for each module.</li>
  <li>Gradle sync time starts to grow.</li>
  <li>IDE becomes very slow and its memory usage goes up a lot.</li>
  <li>Parallel execution of the module depends on the machine‚Äôs capabilities.</li>
</ul>

<h2 id="where-we-are-now">Where we are now</h2>

<p>There are more than 1,000 modules in the Grab app and are still counting.</p>

<p>At Grab, we have many sub-teams which take care of different features available in the app. Grab Financial Group (GFG) is one such sub-team that handles everything related to payments in the app. For example: P2P &amp; P2M money transfers, e-Wallet activation, KYC, and so on.</p>

<p>We started modularising payments further in July 2020 as it was already bombarded with too many features and it was difficult for the team to work on the single payments module. The result of payments modularisation is shown in the following chart.</p>

<div class="post-image-section"><figure>
  <img src="/img/app-modularisation-at-scale/image2.png" alt="Build time graph of payments module" style="width:90%" /> <figcaption align="middle"><i>Build time graph of payments module</i></figcaption>
  </figure></div>

<p>As of today, we have about 200+ modules in GFG and more than 95% of the modules take less than 15s to build.</p>

<h2 id="conclusion">Conclusion</h2>

<p>Modularisation has helped us a lot in reducing the overall build time of the app and also, in improving the developer experience by breaking dependencies and allowing us to define code ownership. Having said that, modularisation is not an easy or a small task, especially for large projects with legacy code. However, with careful planning and the right design, modularisation can help in forming a well-structured and maintainable project.</p>

<p>Hope you enjoyed reading. Don‚Äôt forget to üëè.</p>

<p>References:</p>
<ul>
  <li><a href="https://proandroiddev.com/build-a-modular-android-app-architecture-25342d99de82">https://proandroiddev.com/build-a-modular-android-app-architecture-25342d99de82</a></li>
  <li><a href="https://medium.com/google-developer-experts/modularizing-android-applications-9e2d18f244a0">https://medium.com/google-developer-experts/modularizing-android-applications-9e2d18f244a0</a></li>
  <li><a href="https://medium.com/@mydogtom/modularization-part-1-application-structure-overview-9e465909a9bc">https://medium.com/@mydogtom/modularization-part-1-application-structure-overview-9e465909a9bc</a></li>
</ul>

<h2 id="join-us">Join us</h2>

<p>Grab is a leading superapp in Southeast Asia, providing everyday services that matter to consumers. More than just a ride-hailing and food delivery app, Grab offers a wide range of on-demand services in the region, including mobility, food, package and grocery delivery services, mobile payments, and financial services across over 400 cities in eight countries.</p>

<p>Powered by technology and driven by heart, our mission is to drive Southeast Asia forward by creating economic empowerment for everyone. If this mission speaks to you, <a href="https://grab.careers/">join our team</a> today!</p>
:ET