I"Ã7<h2 id="overview">Overview</h2>

<p>At Grab, the Lending team is focused towards building products that help finance various segments of users, such as Passengers, Drivers, or Merchants, based on their needs. The team builds products that enable users to avail funds in a seamless and hassle-free way. In order to achieve this, multiple lending microservices continuously interact with each other. Each microservice handles different responsibilities, such as providing offers, storing user information, disbursing availed amounts to a userâ€™s account, and many more.</p>

<p>In this tech blog, we will discuss what <em>Data</em> and <em>Extract, Transform and Load (ETL)</em> pipelines are and how they are used for processing multiple tasks in the Lending Team at Grab. We will also discuss <em><a href="https://github.com/dailyburn/ratchet">Ratchet</a></em>, which is a Go library, that helps us in building data pipelines and handling ETL tasks. Letâ€™s start by covering the basis of Data and ETL pipelines.</p>

<h2 id="what-is-a-data-pipeline">What is a Data Pipeline?</h2>

<p>A Data pipeline is used to describe a system or a process that moves data from one platform to another. In between platforms, data passes through multiple steps based on defined requirements, where it may be subjected to some kind of modification. All the steps in a Data pipeline are automated, and the output from one step acts as an input for the next step.</p>

<div class="post-image-section"><figure>
  <img src="/img/processing-etl-tasks-with-ratchet/image1.png" alt="Data Pipeline" style="width:90%" /> <figcaption align="middle"><i>Data Pipeline (Source: <a href="https://hazelcast.com/glossary/data-pipeline/">Hazelcast</a>)</i></figcaption>
  </figure></div>

<h2 id="what-is-an-etl-pipeline">What is an ETL Pipeline?</h2>

<p>An ETL pipeline is a type of Data pipeline that consists of 3 major steps, namely extraction of data from a source, transformation of that data into the desired format, and finally loading the transformed data to the destination. The destination is also known as the <em>sink</em>.</p>

<div class="post-image-section"><figure>
  <img src="/img/processing-etl-tasks-with-ratchet/image3.jpg" alt="Extract-Transform-Load" style="width:90%" /> <figcaption align="middle"><i>Extract-Transform-Load (Source: <a href="https://www.tatvasoft.com/blog/etl-process-extract-transform-load/">TatvaSoft</a>)</i></figcaption>
  </figure></div>

<p>The combination of steps in an ETL pipeline provides functions to assure that the business requirements of the application are achieved.</p>

<p>Letâ€™s briefly look at each of the steps involved in the ETL pipeline.</p>

<h3 id="data-extraction">Data Extraction</h3>

<p>Data extraction is used to fetch data from one or multiple sources with ease. The source of data can vary based on the requirement. Some of the commonly used data sources are:</p>

<ul>
  <li>Database</li>
  <li>Web-based storage (S3, Google cloud, etc)</li>
  <li>Files</li>
  <li>User Feeds, CRM, etc.</li>
</ul>

<p>The data format can also vary from one use case to another. Some of the most commonly used data formats are:</p>

<ul>
  <li>SQL</li>
  <li>CSV</li>
  <li>JSON</li>
  <li>XML</li>
</ul>

<p>Once data is extracted in the desired format, it is ready to be fed to the transformation step.</p>

<h3 id="data-transformation">Data Transformation</h3>

<p>Data transformation involves applying a set of rules and techniques to convert the extracted data into a more meaningful and structured format for use. The extracted data may not always be ready to use. In order to transform the data, one of the following techniques may be used:</p>

<ol>
  <li>Filtering out unnecessary data.</li>
  <li>Preprocessing and cleaning of data.</li>
  <li>Performing validations on data.</li>
  <li>Deriving a new set of data from the existing one.</li>
  <li>Aggregating data from multiple sources into a single uniformly structured format.</li>
</ol>

<h3 id="data-loading">Data Loading</h3>

<p>The final step of an ETL pipeline involves moving the transformed data to a sink where it can be accessed for its use. Based on requirements, a sink can be one of the following:</p>

<ol>
  <li>Database</li>
  <li>File</li>
  <li>Web-based storage (S3, Google cloud, etc)</li>
</ol>

<p>An ETL pipeline may or may not have a loadstep based on its requirements. When the transformed data needs to be stored for further use, the loadstep is used to move the transformed data to the storage of choice. However, in some cases, the transformed data may not be needed for any further use and thus, the loadstep can be skipped.</p>

<p>Now that you understand the basics, letâ€™s go over how we, in the Grab Lending team, use an ETL pipeline.</p>

<h2 id="why-use-ratchet">Why Use Ratchet?</h2>

<p>At Grab, we use Golang for most of our backend services. Due to Golangâ€™s simplicity, execution speed, and concurrency support, it is a great choice for building data pipeline systems to perform custom ETL tasks.</p>

<p>Given that <em><a href="https://github.com/dailyburn/ratchet">Ratchet</a></em> is also written in Go, it allows us to easily build custom data pipelines.</p>

<p>Go channels are connecting each stage of processing, so the syntax for sending data is intuitive for anyone familiar with Go. All data being sent and received is in JSON, providing a nice balance of flexibility and consistency.</p>

<h2 id="utilising-ratchet-for-etl-tasks">Utilising Ratchet for ETL Tasks</h2>

<p>We use Ratchet for multiple ETL tasks like batch processing, restructuring and rescheduling of loans, creating user profiles, and so on. One of the backend services, named <strong>Azkaban</strong>, is responsible for handling various ETL tasks.</p>

<p>Ratchet uses <em>Data Processors</em> for building a pipeline consisting of multiple stages. Data Processors each run in their own <code class="language-plaintext highlighter-rouge">goroutine</code> so all of the data is processed concurrently. Data Processors are organised into stages, and those stages are run within a pipeline. For building an ETL pipeline, each of the three steps (Extract, Transform and Load) use a Data Processor for implementation. Ratchet provides a set of built-in, useful Data Processors, while also providing an interface to implement your own. Usually, the transform stage uses a Custom Data Processor.</p>

<div class="post-image-section"><figure>
  <img src="/img/processing-etl-tasks-with-ratchet/image4.png" alt="Data Processors in Ratchet" style="width:90%" /> <figcaption align="middle"><i>Data Processors in Ratchet (Source: <a href="https://github.com/dailyburn/ratchet">Github</a>)</i></figcaption>
  </figure></div>

<p>Letâ€™s take a look at one of these tasks to understand how we utilise Ratchet for processing an ETL task.</p>

<h2 id="whitelisting-merchants-through-etl-pipelines">Whitelisting Merchants Through ETL Pipelines</h2>

<p>Whitelisting essentially means making the product available to the user by mapping an offer to the user ID. If a merchant in Thailand receives an option to opt for Cash Loan, it is done by whitelisting that merchant. In order to whitelist our merchants, our Operations team uses an internal portal to upload a CSV file with the user IDs of the merchants and other required information. This CSV file is generated by our internal Data and Risk team and handed over to the Operations team. Once the CSV file is uploaded, the user IDs present in the file are whitelisted within minutes. However, a lot of work goes in the background to make this possible.</p>

<h3 id="data-extraction-1">Data Extraction</h3>

<p>Once the Operations team uploads the CSV containing a list of merchant users to be whitelisted, the file is stored in S3 and an entry is created on the Azkaban service with the document ID of the uploaded file.</p>

<div class="post-image-section"><figure>
  <img src="/img/processing-etl-tasks-with-ratchet/image5.png" alt="File upload by Operations team" style="width:90%" /> <figcaption align="middle"><i>File upload by Operations team</i></figcaption>
  </figure></div>

<p>The data extraction step makes use of a Custom CSV Data Processor that uses the document ID to first create a <code class="language-plaintext highlighter-rouge">PreSignedUrl</code> and then uses it to fetch the data from S3. The data extracted is in bytes and we use commas as the delimiter to format the CSV data.</p>

<h3 id="data-transformation-1">Data Transformation</h3>

<p>In order to transform the data, we define a Custom Data Processor that we call a <em>Transformer</em> for each ETL pipeline. Transformers are responsible for applying all necessary transformations to the data before it is ready for loading. The transformations applied in the merchant whitelisting transformers are:</p>

<ol>
  <li>Convert data from bytes to struct.</li>
  <li>Check for presence of all mandatory fields in the received data.</li>
  <li>Perform validation on the data received.</li>
  <li>Make API calls to external microservices for whitelisting the merchant.</li>
</ol>

<p>As mentioned earlier, the CSV file is uploaded manually by the Operations team. Since this is a manual process, it is prone to human errors. Validation of data in the data transformation step helps avoid these errors and not propagate them further up the pipeline. Since CSV data consists of multiple rows, each row passes through all the steps mentioned above.</p>

<h3 id="data-loading-1">Data Loading</h3>

<p>Whenever the merchants are whitelisted, we donâ€™t need to store the transformed data. As a result, we donâ€™t have a loadstep for this ETL task, so we just use an Empty Data Processor. However, this is just one of many use cases that we have. In cases where the transformed data needs to be stored for further use, the loadstep will have a Custom Data Processor, which will be responsible for storing the data.</p>

<h2 id="connecting-all-stages">Connecting All Stages</h2>

<p>After defining our Data Processors for each of the steps in the ETL pipeline, the final piece is to connect all the stages together. As stated earlier, the ETL tasks have different ETL pipelines and each ETL pipeline consists of 3 stages defined by their Data Processors.</p>

<p>In order to connect these 3 stages, we define a <strong>Job Processor</strong> for each ETL pipeline. A Job Processor represents the entire ETL pipeline and encompasses Data Processors for each of the 3 stages. Each Job Processor implements the following methods:</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">SetSource</code>: Assigns the Data Processor for the Extraction stage.</li>
  <li><code class="language-plaintext highlighter-rouge">SetTransformer</code>: Assigns the Data Processor for the Transformation stage.</li>
  <li><code class="language-plaintext highlighter-rouge">SetDestination</code>: Assigns the Data Processor for the Load stage.</li>
  <li><code class="language-plaintext highlighter-rouge">Execute</code>: Runs the ETL pipeline.</li>
</ol>

<div class="post-image-section"><figure>
  <img src="/img/processing-etl-tasks-with-ratchet/image2.png" alt="Job processors containing Data Processor for each stage in ETL" style="width:90%" /> <figcaption align="middle"><i>Job processors containing Data Processor for each stage in ETL</i></figcaption>
  </figure></div>

<p>When the <strong>Azkaban</strong> service is initialised, we run the <code class="language-plaintext highlighter-rouge">SetSource()</code>, <code class="language-plaintext highlighter-rouge">SetTransformer()</code> and <code class="language-plaintext highlighter-rouge">SetDestination()</code> methods for each of the Job Processors defined. When an ETL task is triggered, the <code class="language-plaintext highlighter-rouge">Execute()</code> method of the corresponding Job Processor is run. This triggers the ETL pipeline and gradually runs the 3 stages of ETL pipeline. For each stage, the Data Processor assigned during initialisation is executed.</p>

<h2 id="conclusion">Conclusion</h2>

<p>ETL pipelines help us in streamlining various tasks in our team. As showcased through the example in the above section, an ETL pipeline breaks a task into multiple stages and divides the responsibilities across these stages.</p>

<p>In cases where a task fails in the middle of the process, ETL pipelines help us determine the cause of the failure quickly and accurately. With ETL pipelines, we have reduced the manual effort required for validating data at each step and avoiding propagation of errors towards the end of the pipeline.</p>

<p>Through the use of ETL pipelines and schedulers, we at Lending have been able to automate the entire pipeline for many tasks to run at scheduled intervals without any manual effort involved at all. This has helped us tremendously in reducing human errors, increasing the throughput of the system and making the backend flow more reliable. As we continue to automate more and more of our tasks that have tightly defined stages, we foresee a growth in our ETL pipelines usage.</p>

<h2 id="references">References</h2>

<p><a href="https://www.alooma.com/blog/what-is-a-data-pipeline">https://www.alooma.com/blog/what-is-a-data-pipeline</a></p>

<p><a href="http://rkulla.blogspot.com/2016/01/data-pipeline-and-etl-tasks-in-go-using.html">http://rkulla.blogspot.com/2016/01/data-pipeline-and-etl-tasks-in-go-using</a></p>

<p><a href="https://medium.com/swlh/etl-pipeline-and-data-pipeline-comparison-bf89fa240ce9">https://medium.com/swlh/etl-pipeline-and-data-pipeline-comparison-bf89fa240ce9</a></p>

<h2 id="join-us">Join us</h2>

<p>Grab is a leading superapp in Southeast Asia, providing everyday services that matter to consumers. More than just a ride-hailing and food delivery app, Grab offers a wide range of on-demand services in the region, including mobility, food, package and grocery delivery services, mobile payments, and financial services across over 400 cities in eight countries.</p>

<p>Powered by technology and driven by heart, our mission is to drive Southeast Asia forward by creating economic empowerment for everyone. If this mission speaks to you, <a href="https://grab.careers/">join our team</a> today!</p>
:ET